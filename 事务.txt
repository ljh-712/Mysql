事务
什么是事务

事务指逻辑上的一组操作，组成这组操作的各个单元，要么全部成功，要么全部失败。
在不同的环境中，都可以有事务。对应在数据库中，就是数据库事务。
比如你将一个交通银行卡里的100万钱转到建设银行，

    查询交行卡账户的余额是否大于100万
    从交行卡账户余额中减去100万
    在建设账户余额中增加100万

以下语句对应创建了一个转账事务：
STARTTRANSACTION;
SELECT balance FROM CMBC WHERE username=‘you’;
UPDATE CMBC SET balance = balance - 1000000.00WHERE username = ‘you’;
UPDATE ICBC SET balance = balance + 1000000.00WHERE username = ‘lemon’;
COMMIT;
事务四大特性

    原子性（atomicity)一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作。
    一致性（consistency)数据库总是从一个一致性的状态转换到另外一个一致性的状态。在前面的例子中，一致性确保了，即使在执行第三、四条语句之间时系统崩溃，CMBC账户中也不会损失100万，不然lemon要哭死，因为事务最终没有提交，所以事务中所做的修改也不会保存到数据库中。
    隔离性（isolation)通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。在前面的例子中，当执行完第三条语句、第四条语句还未开始时，此时如果有其他人准备给你的CMBC账户存钱，那他看到的CMBC账户里还是有100万的。
    持久性（durability)一旦事务提交，则其所做的修改就会永久保存到数据库中。此时即使系统崩溃，修改的数据也不会丢失。持久性是个有点模糊的概念，因为实际上持久性也分很多不同的级别。有些持久性策略能够提供非常强的安全保障，而有些则未必。而且「不可能有能做到100%的持久性保证的策略」否则还需要备份做什么。

什么是脏读、不可重复读、幻读

    脏读
    在事务A修改数据之后提交数据之前，这时另一个事务B来读取数据，如果不加控制，事务B读取到A修改过数据，之后A又对数据做了修改再提交，则B读到的数据是脏数据，此过程称为脏读Dirty Read

    不可重复读
    一个事务内在读取某些数据后的某个时间，再次读取以前读过的数据，却发现其读出的数据已经发生了变更、或者某些记录已经被删除了。
    幻读
    事务A在按查询条件读取某个范围的记录时，事务B又在该范围内插入了新的满足条件的记录，当事务A再次按条件查询记录时，会产生新的满足条件的记录（幻行 Phantom Row）

事务隔离级别

    读未提交
    读已提交
    可重复读（Mysql默认隔离级别）
    可串行化（类似于多线程加锁）
    在这里插入图片描述

MySQL中哪些存储引擎支持事务？

MySQL中InnoDB和NDB Cluster存储引擎提供了事务处理能力，以及其他支持事务的第三引擎。
――――――――――――――――
